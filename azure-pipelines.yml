# Azure DevOps pipeline with multiple examples embedded.
# Pipeline key concepts are explained here: https://learn.microsoft.com/azure/devops/pipelines/get-started/key-pipelines-concepts

# Using the default filename 'azure-pipelines.yml' will auto-register the pipeline in Azure DevOps.
# If you want to use a different filename, you will need to register the pipeline manually.

# When to run the pipeline.
trigger: 
- main


# Optionally Run examples:
parameters:
  - name: variables
    displayName: Run variables examples
    type: boolean
    default: false
  - name: job_types
    displayName: Run Job types examples
    type: boolean
    default: false
  - name: agentless
    displayName: Run Agentless examples
    type: boolean
    default: false
  - name: git
    displayName: Run Git examples
    type: boolean
    default: false
  - name: azure_cli
    displayName: Run Azure CLI examples
    type: boolean
    default: false


# Default pool for all stages and jobs
pool:
  # Use MS-hosted agents: https://learn.microsoft.com/azure/devops/pipelines/agents/hosted  
  # Installed Software: https://github.com/actions/runner-images/blob/main/images/linux/Ubuntu2204-Readme.md
  vmImage: 'ubuntu-latest'  # other example: 'windows-latest'


# Various types of variables can be defined here.
variables:
- template: templates\global-vars.yml
# group: https://docs.microsoft.com/azure/devops/pipelines/library/variable-groups
- group: lookup-variables
- name: runtimeVar
  value: $[variables['var1-in-group']] # key inside group: lookup-variables
- name: overwriteVar
  value: 'top level'
- name: azure_service_connection
  value: arm-example-conn


# Stages are the major divisions in a pipeline.
stages:
{{ if eq(parameters.variables, true) }}:
  - template: templates\1-variables.yml
{{ if eq(parameters.job_types, true) }}:
  - template: templates\2-job-types.yml
{{ if eq(parameters.agentless, true) }}:
  - template: templates\3-agentless.yml
{{ if eq(parameters.git, true) }}:
  - template: templates\4-git.yml
{{ if eq(parameters.azure_cli, true) }}:
  - template: templates\5-azure-cli.yml

# TODO: Add examples for the following:
# Resources: https://docs.microsoft.com/azure/devops/pipelines/process/resources?view=azure-devops&tabs=schema
# Logging & Extensions: https://docs.microsoft.com/azure/devops/pipelines/scripts/logging-commands
# Conditions: https://docs.microsoft.com/azure/devops/pipelines/process/conditions?view=azure-devops&tabs=yaml